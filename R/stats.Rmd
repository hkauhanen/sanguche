---
title: "Contact helps dispreferred combinations of typological features to survive: geospatial evidence"
subtitle: "Statistical analyses"
output: html_document
---


# Preliminaries

```{r}
# required packages
require(tidyverse)
require(broom)
require(pixiedust)
require(emmeans)
source("pvalString_demo.R")

# create results/tables, if it doesn't exist already
try(dir.create("../results/tables", recursive=TRUE))

# load data
source("load_data.R")

# make "non-interacting" the reference level of "status" factor
data$status <- relevel(data$status, ref="non-interacting")
wals$status <- relevel(wals$status, ref="non-interacting")
gram$status <- relevel(gram$status, ref="non-interacting")
```

# Descriptive statistics

Mean sample size, WALS:

```{r}
round(mean(wals$N))
```

Mean sample size, Grambank:

```{r}
round(mean(gram$N))
```

These suggest the following neighbourhood sizes to use:

```{r}
round(sqrt(round(mean(wals$N))))
```

and

```{r}
round(sqrt(round(mean(gram$N))))
```


# Basic model: comparison of $\Delta$ between typologies of different statuses

## Under-represented types ($\Delta^-$)

```{r}
mod1_under_w <- lm(Delta_under ~ status+abs(phi), data=wals)
mod1_under_g <- lm(Delta_under ~ status+abs(phi), data=gram)

mathematize <- function(value) {
  paste0("[", value, "]")
}

mod1_under_w %>% 
  dust %>% 
  sprinkle(round=3) %>% 
  sprinkle(cols="term", replace=c("intercept", "interacting (vs. non-interacting)", 
                                  "unknown (vs. non-interacting)", "|φ|")) %>% 
  sprinkle(cols="p.value", fn = quote(pvalString_demo(value, stars=TRUE))) %>%
  write.table(file="../results/tables/mod1_under_wals.csv", 
              row.names=FALSE, col.names=FALSE, sep=",", quote=FALSE)

mod1_under_g %>% 
  dust %>% 
  sprinkle(round=3) %>% 
  sprinkle(cols="term", replace=c("intercept", "interacting (vs. non-interacting)", 
                                  "unknown (vs. non-interacting)", "|φ|")) %>% 
  sprinkle(cols="p.value", fn = quote(pvalString_demo(value, stars=TRUE))) %>%
  write.table(file="../results/tables/mod1_under_grambank.csv", 
              row.names=FALSE, col.names=FALSE, sep=",", quote=FALSE)

print(summary(mod1_under_w))
print(summary(mod1_under_g))
```


## Over-represented types ($\Delta^+$)

```{r}
mod1_over_w <- lm(Delta_over ~ status+abs(phi), data=wals)
mod1_over_g <- lm(Delta_over ~ status+abs(phi), data=gram)

mod1_over_w %>% 
  dust %>% 
  sprinkle(round=3) %>% 
  sprinkle(cols="term", replace=c("intercept", "interacting (vs. non-interacting)", 
                                  "unknown (vs. non-interacting)", "|φ|")) %>% 
  sprinkle(cols="p.value", fn = quote(pvalString_demo(value, stars=TRUE))) %>%
  write.table(file="../results/tables/mod1_over_wals.csv", 
              row.names=FALSE, col.names=FALSE, sep=",", quote=FALSE)

mod1_over_g %>% 
  dust %>% 
  sprinkle(round=3) %>% 
  sprinkle(cols="term", replace=c("intercept", "interacting (vs. non-interacting)", 
                                  "unknown (vs. non-interacting)", "|φ|")) %>% 
  sprinkle(cols="p.value", fn = quote(pvalString_demo(value, stars=TRUE))) %>%
  write.table(file="../results/tables/mod1_over_grambank.csv", 
              row.names=FALSE, col.names=FALSE, sep=",", quote=FALSE)

print(summary(mod1_over_w))
print(summary(mod1_over_g))
```


# Model 2: model comparison between $\varphi$ and $\varphi_c$ as predictors

```{r}
# set up dataframe for exporting the values
out <- data.frame(dataset=c("WALS", "Grambank"), under_phi=NA, under_phic=NA, over_phi=NA, over_phic=NA)
```

## Under-represented types

```{r}
mod_w <- lm(Delta_under ~ abs(phi), data=wals)
mod_wc <- lm(Delta_under ~ abs(corrected_phi), data=wals)

print(summary(mod_w))
print(summary(mod_wc))

print(AIC(mod_w))
print(AIC(mod_wc))

out[out$dataset == "WALS", ]$under_phi <- round(AIC(mod_w), 1)
out[out$dataset == "WALS", ]$under_phic <- round(AIC(mod_wc), 1)

mod_g <- lm(Delta_under ~ abs(phi), data=gram)
mod_gc <- lm(Delta_under ~ abs(corrected_phi), data=gram)

print(summary(mod_g))
print(summary(mod_gc))

print(AIC(mod_g))
print(AIC(mod_gc))

out[out$dataset == "Grambank", ]$under_phi <- round(AIC(mod_g), 1)
out[out$dataset == "Grambank", ]$under_phic <- round(AIC(mod_gc), 1)
```

## Over-represented types

```{r}
mod_w <- lm(Delta_over ~ abs(phi), data=wals)
mod_wc <- lm(Delta_over ~ abs(corrected_phi), data=wals)

print(summary(mod_w))
print(summary(mod_wc))

print(AIC(mod_w))
print(AIC(mod_wc))

out[out$dataset == "WALS", ]$over_phi <- round(AIC(mod_w), 1)
out[out$dataset == "WALS", ]$over_phic <- round(AIC(mod_wc), 1)

mod_g <- lm(Delta_over ~ abs(phi), data=gram)
mod_gc <- lm(Delta_over ~ abs(corrected_phi), data=gram)

print(summary(mod_g))
print(summary(mod_gc))

print(AIC(mod_g))
print(AIC(mod_gc))

out[out$dataset == "Grambank", ]$over_phi <- round(AIC(mod_g), 1)
out[out$dataset == "Grambank", ]$over_phic <- round(AIC(mod_gc), 1)

write.table(out, file="../results/tables/AIC.csv", sep=",", quote=FALSE, row.names=FALSE, col.names=FALSE)
```

